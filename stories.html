<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Draggable & Zoomable Video</title>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        background: transparent;
        color: #fff;
        height: 100vh;
        overflow: hidden;
      }

      .video-container {
        position: fixed;
        width: 35%;
        height: 30%;
        border: 2px solid rgba(255, 255, 255, 0.5);
        border-radius: 10px;
        overflow: hidden;
        background: rgba(0, 0, 0, 0.8);
        touch-action: none;
        transition: transform 0.3s ease-in-out;
        cursor: grab;
        display: flex;
        align-items: center;
        justify-content: center;
      }

      video {
        width: 100%;
        height: 100%;
        object-fit: contain;
      }

      .btn {
        position: absolute;
        padding: 5px;
        background: rgba(255, 255, 255, 0.3);
        border: none;
        cursor: pointer;
        border-radius: 5px;
        display: flex;
        align-items: center;
        justify-content: center;
        width: 30px;
        height: 30px;
      }

      .fullscreen-btn {
        bottom: 10px;
        right: 10px;
      }

      .mute-btn {
        bottom: 10px;
        left: 10px;
      }

      .close-btn {
        top: 10px;
        right: 10px;
      }
    </style>
  </head>
  <body>
    <div class="video-container" id="video-container">
      <video id="video" autoplay muted loop playsinline disablePictureInPicture>
        <source src="https://files.catbox.moe/xv4xan.mp4" type="video/mp4" />
        Your browser does not support HTML5 video.
      </video>

      <button id="mute-btn" class="btn mute-btn">
        <img
          id="mute-icon"
          src="https://cdn-icons-png.flaticon.com/512/727/727240.png"
          width="20"
          height="20"
        />
      </button>

      <button id="fullscreen-btn" class="btn fullscreen-btn">
        <img
          id="fullscreen-icon"
          src="https://cdn-icons-png.flaticon.com/512/3917/3917215.png"
          width="20"
          height="20"
        />
      </button>

      <button id="close-btn" class="btn close-btn">
        <img
          src="https://cdn-icons-png.flaticon.com/512/1828/1828774.png"
          width="20"
          height="20"
        />
      </button>
    </div>

    <script>
      const videoContainer = document.getElementById("video-container");
      const video = document.getElementById("video");
      const fullscreenBtn = document.getElementById("fullscreen-btn");
      const fullscreenIcon = document.getElementById("fullscreen-icon");
      const muteBtn = document.getElementById("mute-btn");
      const muteIcon = document.getElementById("mute-icon");
      const closeBtn = document.getElementById("close-btn");

      let isZoomed = false;
      let isDragging = false;
      let startX, startY;

      function resetPosition() {
        const screenHeight = window.innerHeight;
        videoContainer.style.left = "20px";
        videoContainer.style.top = `${
          screenHeight - videoContainer.offsetHeight - 20
        }px`;
      }

      window.addEventListener("load", resetPosition);
      window.addEventListener("resize", resetPosition);

      fullscreenBtn.addEventListener("click", () => {
        if (!isZoomed) {
          videoContainer.style.width = "90%";
          videoContainer.style.height = "80%";
          fullscreenIcon.src =
            "https://cdn-icons-png.flaticon.com/512/1828/1828778.png";

          video.muted = false;
          video.play();
          muteIcon.src =
            "https://cdn-icons-png.flaticon.com/512/2088/2088090.png";
        } else {
          videoContainer.style.width = "35%";
          videoContainer.style.height = "30%";
          fullscreenIcon.src =
            "https://cdn-icons-png.flaticon.com/512/3917/3917215.png";

          video.muted = true;
          muteIcon.src =
            "https://cdn-icons-png.flaticon.com/512/727/727240.png";
        }
        isZoomed = !isZoomed;
        resetPosition();
      });

      muteBtn.addEventListener("click", () => {
        video.muted = !video.muted;
        muteIcon.src = video.muted
          ? "https://cdn-icons-png.flaticon.com/512/727/727240.png"
          : "https://cdn-icons-png.flaticon.com/512/2088/2088090.png";
      });

      closeBtn.addEventListener("click", () => {
        console.log("Close button triggered");
        if (window.CleverTap) {
          CleverTap.dismissInAppNotification();
        } else {
          window.location.href = "wzrk://thisleads";
        }
      });

      // Dragging logic
      function startDrag(e) {
        isDragging = true;
        startX =
          (e.touches ? e.touches[0].clientX : e.clientX) -
          videoContainer.offsetLeft;
        startY =
          (e.touches ? e.touches[0].clientY : e.clientY) -
          videoContainer.offsetTop;
        videoContainer.style.cursor = "grabbing";
      }

      function dragMove(e) {
        if (!isDragging) return;

        let newX = (e.touches ? e.touches[0].clientX : e.clientX) - startX;
        let newY = (e.touches ? e.touches[0].clientY : e.clientY) - startY;

        const screenWidth = window.innerWidth;
        const screenHeight = window.innerHeight;
        const containerWidth = videoContainer.offsetWidth;
        const containerHeight = videoContainer.offsetHeight;

        newX = Math.max(0, Math.min(screenWidth - containerWidth, newX));
        newY = Math.max(0, Math.min(screenHeight - containerHeight, newY));

        videoContainer.style.left = `${newX}px`;
        videoContainer.style.top = `${newY}px`;
      }

      function stopDrag() {
        isDragging = false;
        videoContainer.style.cursor = "grab";
      }

      videoContainer.addEventListener("mousedown", startDrag);
      document.addEventListener("mousemove", dragMove);
      document.addEventListener("mouseup", stopDrag);

      videoContainer.addEventListener("touchstart", startDrag, {
        passive: true,
      });
      document.addEventListener("touchmove", dragMove, { passive: true });
      document.addEventListener("touchend", stopDrag);

      // Detect clicks outside the video container
      document.addEventListener("touchstart", (e) => {
        if (!videoContainer.contains(e.target)) {
          if (window.CleverTap) {
            CleverTap.dismissInAppNotification();
          }

          // Call IOS interface
          else {
            window.location.href = "wzrk://thisleadstonowhere";
          }
        }
      });
    </script>
  </body>
</html>
